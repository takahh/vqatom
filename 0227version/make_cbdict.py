# -*- coding: utf-8 -*-
import re
from collections import OrderedDict

# ① ここにあなたが貼ってくれた「key,: value,」の一覧をそのままコピペ
RAW_TEXT = """
16_0_4_0_0_4_0_0_0_0_13,: 531,
6_0_3_0_0_2_0_0_0_0_0,: 639,
6_0_3_0_0_3_0_0_0_0_2,: 7009,
6_0_3_0_0_3_0_2_0_0_0,: 35,
6_0_3_1_1_2_6_2_1_1_10,: 36348,
6_0_3_1_1_2_6_2_2_1_10,: 34679,
6_0_3_1_1_2_6_2_3_1_10,: 27842,
6_0_3_1_1_3_6_2_1_0_10,: 16513,
6_0_3_1_1_3_6_2_2_0_10,: 13425,
6_0_3_1_1_3_6_2_3_0_10,: 9238,
6_0_4_0_0_1_0_0_0_0_0,: 16159,
6_0_4_0_0_2_0_0_0_0_0,: 16025,
6_0_4_0_0_3_0_1_0_0_6,: 157,
7_0_3_0_0_2_0_0_0_0_2,: 5557,
7_0_3_0_0_2_0_1_0_0_1,: 1976,
8_0_3_0_0_1_0_0_0_0_13,: 3712,
8_0_3_0_0_1_0_0_0_0_2,: 13524,
9_0_4_0_0_1_0_1_0_0_12,: 3880,
16_0_4_0_0_4_0_1_0_0_0,: 344,
6_0_3_1_1_3_5_2_2_0_10,: 2719,
6_0_3_1_1_3_5_3_2_0_10,: 4509,
6_0_3_1_1_3_6_3_1_0_10,: 5242,
6_0_3_1_1_3_6_3_2_0_10,: 5200,
7_0_3_0_0_1_0_1_0_0_1,: 1286,
7_0_3_1_1_2_5_2_2_0_10,: 3387,
7_0_3_1_1_2_6_2_1_0_10,: 4422,
7_0_3_1_1_3_5_3_2_0_10,: 626,
8_0_3_0_0_1_0_0_0_0_0,: 1782,
6_0_3_0_1_3_7_1_1_0_2,: 35,
6_0_3_1_1_3_6_2_1_0_6,: 1807,
7_0_3_0_1_3_7_1_1_0_2,: 67,
17_0_4_0_0_0_0_0_0_0_12,: 385,
17_0_4_0_0_1_0_1_0_0_12,: 4424,
6_0_3_0_0_3_0_1_0_0_2,: 3973,
6_0_3_1_1_2_6_2_4_1_10,: 12291,
6_0_3_1_1_3_6_2_2_0_6,: 1318,
6_0_3_1_1_3_6_2_3_0_6,: 880,
6_0_3_1_1_3_6_2_3_0_9,: 261,
6_0_3_1_1_3_6_2_4_0_10,: 3600,
6_0_4_0_1_2_7_0_1_0_0,: 348,
7_0_3_0_0_2_0_1_0_0_2,: 2823,
7_0_4_0_1_3_7_0_1_0_1,: 35,
8_0_3_0_0_1_0_1_0_0_9,: 1604,
6_0_3_1_1_2_5_2_1_1_10,: 2444,
6_0_3_1_1_3_5_2_1_0_10,: 4247,
6_0_3_1_1_3_5_3_1_0_10,: 5359,
6_0_4_0_0_1_0_1_0_0_0,: 5076,
6_0_4_0_0_2_0_1_0_0_0,: 6889,
6_0_4_0_0_4_0_0_0_0_0,: 858,
6_0_4_0_0_4_0_1_0_0_0,: 1641,
7_0_3_1_1_2_5_2_1_0_10,: 3613,
7_0_3_1_1_3_5_3_1_0_10,: 648,
7_0_4_0_0_3_0_0_0_0_1,: 777,
9_0_4_0_0_1_0_0_0_0_12,: 6537,
16_0_3_1_1_2_5_2_3_0_10,: 401,
16_0_4_0_0_4_0_1_0_0_13,: 1245,
6_0_3_0_0_2_0_0_0_0_6,: 409,
6_0_3_0_0_2_0_1_0_0_0,: 723,
6_0_3_1_1_2_5_2_3_1_10,: 2027,
6_0_3_1_1_3_5_2_3_0_10,: 1550,
6_0_4_0_0_2_0_2_0_0_0,: 947,
7_0_3_1_1_3_5_2_1_0_10,: 1399,
6_0_3_0_0_3_0_0_0_0_3,: 1299,
6_0_3_1_1_3_6_2_1_0_8,: 4388,
6_0_3_1_1_3_6_3_3_0_10,: 3186,
6_0_4_0_0_1_0_0_0_0_7,: 337,
6_0_4_0_0_2_0_0_0_0_6,: 2094,
6_0_4_0_0_2_0_1_0_0_8,: 664,
7_0_3_0_0_3_0_0_0_0_2,: 616,
8_0_3_0_0_1_0_0_0_0_3,: 3512,
8_0_3_0_0_2_0_0_0_0_7,: 1283,
8_0_3_0_0_2_0_1_0_0_8,: 6060,
8_0_3_1_1_2_5_2_2_0_10,: 380,
16_0_4_0_0_4_0_0_0_0_0,: 101,
6_0_3_1_1_3_6_2_1_0_9,: 744,
6_0_3_0_1_3_6_0_2_0_2,: 149,
6_0_4_0_1_2_6_0_2_0_0,: 8967,
...
6_0_3_0_1_3_5_1_2_0_6,: 32,
1_0_1_0_0_1_0_0_0_0_0,: 48,
"""

# ② 生データを dict にパース
raw = OrderedDict()
for line in RAW_TEXT.splitlines():
    line = line.strip()
    if not line:
        continue
    # "key,: value," を拾う
    m = re.match(r'([^,]+),:\s*([0-9]+),?', line)
    if not m:
        # うまくマッチしない行があればスキップ（必要なら print してデバッグ）
        # print("no match:", line)
        continue
    key = m.group(1)
    val = int(m.group(2))
    raw[key] = val

print(f"#classes = {len(raw)}")
total_atoms = sum(raw.values())
print(f"total_atoms = {total_atoms}")

TARGET_TOTAL = 10000

# ③ 比例配分で目標値を作る（最低1）
scale = TARGET_TOTAL / total_atoms
proposed = {k: max(1, round(v * scale)) for k, v in raw.items()}

print("sum(proposed) =", sum(proposed.values()))

# ④ 合計が 10000 になるよう微調整
current_total = sum(proposed.values())
diff = current_total - TARGET_TOTAL

if diff != 0:
    # 各クラスの「rounded - exact」の偏りを見る
    scaled = {k: v * scale for k, v in raw.items()}
    # (偏り, key) のリスト。diff >0 なら負の偏りから減らし、diff<0 なら正の偏りから増やす
    frac_list = sorted([(proposed[k] - scaled[k], k) for k in raw])

    if diff > 0:
        # 多すぎるので diff 回分だけ 1 減らす（1より大きいところから）
        for frac, k in frac_list:
            if diff == 0:
                break
            if proposed[k] > 1:
                proposed[k] -= 1
                diff -= 1
    elif diff < 0:
        # 少なすぎるので -diff 回だけ 1 増やす（偏りの大きい方から）
        for frac, k in reversed(frac_list):
            if diff == 0:
                break
            proposed[k] += 1
            diff += 1

print("adjusted total =", sum(proposed.values()))

# ⑤ CBDICT として使いやすい形で出力
print("\nCBDICT = {")
for k, v in sorted(proposed.items(), key=lambda x: x[1], reverse=True):
    print(f"    '{k}': {v},")
print("}")
